\input sys/inputs.tex

\begin{document}

\bigheading{Brackets}

% \info{task_name}{infile}{outfile}{points}{timelimit}{memlimit}
% leave this values, if you are not interested
\info{brackets}{stdin}{stdout}{100}{100 ms}{1 GB}



% This is how you can include a picture:

% \includegraphics[height=5cm]{img/picture.jpg}

\heading{Task}

A bracket symbol is one of the following: \texttt{()[]\{\}<>}. A correct \textit{bracket expression} is any string consisting of bracket symbols, such that:
\begin{itemize}
 \item Every left bracket has a matching right bracket of the same kind, and every right bracket is matched;
 \item No two pairs of matching brackets cross -- for every two such pairs, they are either disjoint or one is contained inside the other.
\end{itemize}
For example, \texttt{([])<>} is a correct bracket expression, whereas \texttt{<\{>\}} is not, as the curly brackets and angle brackets cross each other.

You are given a graph of $n$ vertices in which every (directed) edge is labeled with one of the bracket symbols. A path in this graph is \textit{valid}, if its edges form a correct bracket expression. For some two vertices $s$ and $t$, determine the length of a shortest valid path between $s$ and $t$. We allow the path to pass multiple times through any vertex.


\heading{Input}

On the first line of input there are four integers $n, m, s, t$ ($1 \leq n \leq 200$, $0 \leq m \leq 2000$, $1 \leq s, t \leq n$) -- the number of vertices, edges, starting and ending vertex, respectively.
Each of the following $m$ lines contains two integers $x$, $y$ and a bracket symbol $b$ ($1 \leq x, y \leq n$), which describe one graph edge. Note that there may be loops and multiple edges.

\heading{Output}

Output a single line containing a single integer -- the length of the shortest valid path between $s$ and $t$. If there is no such path, output $-1$. You may assume that if a path exists, its length does not exceed $10^{18}$.

\heading{Subtasks}

\begin{tabular}{|c|c|c|}
	\hline
	Subtask & Points  & Description \\
	\hline
	1 & 16 & $n \leq 10, m\leq 50$ \\
	\hline
	2 & 16 & $n \leq 20, m\leq 100$\\
	\hline
	3 & 16 & $n \leq 50$\\
	\hline
	4 & 16 & $n \leq 100$ \\
	\hline
	5  & 10 & $s = 1$, $t = n$, $a < b$ for every edge $(a,b)$\\
	\hline
	6 & 26  & no additional constraints \\
	\hline
\end{tabular}

\heading{Samples}


\sampleIN
4 4 1 4
1 2 (
2 2 [
2 3 ]
3 4 )
\sampleOUT
4
\sampleEND
\sampleIN
5 4 1 5
1 2 <
2 3 \{
3 4 >
4 5 \}
\sampleOUT
-1

\sampleEND



\end{document}
